source: invoices
primary_key: InvoiceId

related:
  customer:
    table: customers
    foreign_key: CustomerId


measures:
  min_sale_date:
    metric: false
    name: First Sale Date
    description: Not a metric, used in customers dimension.
    type: date
    expr: min(InvoiceDate)


dimensions:
  invoice_date: &date
    name: Sale Date
    expr: InvoiceDate
    type: date
    query_defaults:
      filter: last(30, 'day')
      transform: datetrunc('day')

  invoice_datetime:
    <<: *date
    name: Sale Datetime
    type: datetime

  order_amount:
    name: Order Amount
    expr: Total
    type: number

  order_amount_10_dollar_bins:
    name: Total Order Amount ($10 bins)
    expr: Total // 10 * 10
    type: currency
    currency: USD

  invoice_year:
    name: Invoice Year
    type: number
    expr: datepart('year', :invoice_date)

  leap_year:
    name: Invoice Date is in Leap Year
    expr: |
      if(:invoice_year % 400 == 0, 'Yes',
          :invoice_year % 100 != 0 and :invoice_year % 4 == 0, 'Yes',
          'No'
        )
    type: string
