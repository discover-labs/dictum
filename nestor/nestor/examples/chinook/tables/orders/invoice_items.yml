source: invoice_items

related:
  invoice:
    table: invoices
    foreign_key: InvoiceId
  track:
    table: tracks
    foreign_key: TrackId

.usd: &USD
  spec: $.2f
  currency_prefix: $


measures:
  revenue:
    name: Revenue
    expr: sum(UnitPrice * Quantity)
    format:
      <<: *USD

  unique_paying_customers:
    name: Unique Paying Customers
    expr: countd(invoice.CustomerId)
    description: |
      Number of unique users who made an order.

  items_sold:
    name: Number of Items Sold
    expr: sum(Quantity)
    format: .0f

  arppu:
    name: Average Revenue per Paying Customer
    expr: $revenue / $unique_paying_customers
    format:
      <<: *USD

  avg_sold_unit_price:
    name: Averate Sold Unit Price
    description: Average price of a track that we sold.
    expr: $revenue / $items_sold
    format:
      <<: *USD


dimensions:
  order_customer_country:
    name: Order's Customer Country
    description: Duplicate of Customer Country, used for tests
    type: nominal
    expr: :customer_country

  first_order_cohort_month:
      name: Month After First Order
      type: ordinal
      expr: datediff('month', :customer_first_sale_date, :invoice_date)
